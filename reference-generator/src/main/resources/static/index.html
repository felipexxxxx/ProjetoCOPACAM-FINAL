<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criação de Referências</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center">Tabela de Criação de Referências e Descrições de Produtos</h1>
    <div class="d-flex justify-content-end mb-2">
        <button id="botaoSair" class="btn btn-secondary">Sair</button>
    </div>
    
        <div class="d-flex justify-content-start mb-3">
            <div class="text-center mt-3">
                <a href="https://drive.google.com/file/d/1B52LJCSza7_g3G-l7E7rNZbAkYLfJ_FZ/preview" target="_blank" class="btn btn-secondary">
                    Abrir Documento de Referência
                </a>
            </div> 
        </div>
        <div class="text-center mt-2">
            <button id="verCamaroes" class="btn btn-secondary" onclick="window.location.href='paginaProdutos.html'">Lista de produtos cadastrados</button>
        </div>
    <form id="descricaoForm" class="mt-4">
        <!-- Espécie -->
        <div class="mb-3">
            <label for="descricaoEspecie" class="form-label">Produto primário:</label>
            <div class="input-group">
                <input type="text" id="descricaoEspecie" class="form-control" placeholder="Espécie" readonly>
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Opções</button>
                <ul class="dropdown-menu" id="dropdownEspecie">
                    <!-- Dinamicamente preenchido -->
                </ul>
            </div>
        </div>

        <!-- Apresentação -->
        <div class="mb-3">
            <label for="descricaoApresentacao" class="form-label">Apresentação:</label>
            <div class="input-group">
                <input type="text" id="descricaoApresentacao" class="form-control" placeholder="Apresentação" readonly>
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Opções</button>
                <ul class="dropdown-menu" id="dropdownApresentacao">
                    <!-- Dinamicamente preenchido -->
                </ul>
            </div>
        </div>

        <!-- Condição -->
        <div class="mb-3">
            <label for="descricaoEstado" class="form-label">Estado:</label>
            <div class="input-group">
                <input type="text" id="descricaoEstado" class="form-control" placeholder="Estado" readonly>
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Opções</button>
                <ul class="dropdown-menu" id="dropdownEstado">
                    <!-- Dinamicamente preenchido -->
                </ul>
            </div>
        </div>

        <!-- Estado -->
        <div class="mb-3">
            <label for="descricaoCondicao" class="form-label">Tipo de Conservação:</label>
            <div class="input-group">
                <input type="text" id="descricaoCondicao" class="form-control" placeholder="Tipo de Conservação" readonly>
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Opções</button>
                <ul class="dropdown-menu" id="dropdownCondicao">
                    <!-- Dinamicamente preenchido -->
                </ul>
            </div>
        </div>
        <div class="mb-3">
            <label for="descricaoPecas" class="form-label">Peças p/pacote:</label>
            <div class="input-group">
                <input type="text" id="pecasMinima" class="form-control" placeholder="Mínimo (ex.:70)" maxlength="4" oninput="AtualizarTabelaReferencia()">
                <input type="text" id="pecasMaxima" class="form-control" placeholder="Máximo (ex.:100)" maxlength="4" oninput="AtualizarTabelaReferencia()">
            </div>
        </div>

        <!-- Classificação -->
        <div class="mb-3">
            <label for="descricaoClassificacao" class="form-label">Classificação:</label>
            <div class="input-group">
                <input type="text" id="classificacaoMinima" class="form-control" placeholder="Mínimo (ex.:40)" maxlength="3" oninput="AtualizarTabelaReferencia()">
                <input type="text" id="classificacaoMaxima" class="form-control" placeholder="Máximo (ex.:50)" maxlength="3" oninput="AtualizarTabelaReferencia()">
            </div>
        </div>

        <!-- Pacote -->
        <div class="mb-3">
            <label for="descricaoPacote" class="form-label">Pacote:</label>
            <div class="input-group">
                <input type="text" id="descricaoPacote" class="form-control" placeholder="Pacote" readonly>
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Opções</button>
                <ul class="dropdown-menu" id="dropdownPacote">
                    <!-- Dinamicamente preenchido -->
                </ul>
            </div>
        </div>
        <!-- Caixa -->
        <div class="mb-3">
            <label for="descricaoCaixa" class="form-label">Caixa:</label>
            <div class="input-group">
                <input type="text" id="descricaoCaixa" class="form-control" placeholder="Caixa" readonly>
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Opções</button>
                
                <ul class="dropdown-menu" id="dropdownCaixa">
                    <!-- Dinamicamente preenchido -->
                </ul>
                
            </div>
         
        </div>
        
        <!-- Tipo de embalagem -->
        <div class="mb-3">
            <label for="descricaoEmbalagem" class="form-label">Tipo de embalagem:</label>
            <div class="input-group">
                <input type="text" id="descricaoEmbalagem" class="form-control" placeholder="Tipo de embalagem" readonly>
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Opções</button>
                <ul class="dropdown-menu" id="dropdownEmbalagem">
                    <!-- Dinamicamente preenchido -->
                </ul>
            </div>
        </div>
        <div id="botaoCriarProduto" class="copiar-botao-container2 text-end">
            <button id="criarProduto" class="btn btn-success me-2">Criar Produto</button>
        </div>
    </form>
 
    <!-- Resultados -->
    <div class="mt-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h3 class="mb-0">Referência do Produto</h3>
        </div>
        <table class="table table-bordered text-center">
            <thead class="thead-dark">
                <tr>
                    <th>Produto primário</th>
                    <th>Apresentação</th>
                    <th>Estado</th>
                    <th>Tipo de Conservação</th>
                    <th>Classificação</th>
                    <th>Pacote (g)</th>
                    <th>Caixa (Kg)</th>
                    <th>Tipo de embalagem</th>
                    <th>Referência completa</th>
                </tr>
            </thead>
            <tbody id="tabelaDescricao" class="table">
                <tbody id="tabelaDescricao">
                </tbody>
                
            </tbody>
        </table>
        <div id="botaoCopiarTabelaOriginal" class="copiar-botao-container text-end">
            <button class="btn btn-primary" onclick="copiarTabela1('tabelaDescricao')">Copiar</button>
        </div>
           
        <!-- Nova tabela dinâmica para IN NATURA -->
         <table id="tabelaInNatura" class="table table-bordered text-center" style="display: none;">
            <thead class="thead-dark">
                <tr>
                    <th>Produto primário</th>
                      <th>Apresentação</th>
                      <th>Gramatura</th>
                      <th>Referência completa</th>
                    </tr>
                 </thead>
             <tbody id="tabelaDescricaoInNatura">
        <!-- O conteúdo será preenchido dinamicamente -->
        </tbody>
    </table>
    
    <div id="botaoCopiarTabelaInNatura" class="copiar-botao-container text-end" style="display: none;">
        <button id="criarProdutoInNatura" class="btn btn-success">Criar Produto In Natura</button>
        <button class="btn btn-primary" onclick="copiarTabela1('tabelaDescricaoInNatura')">Copiar</button>
        
    </div>
    
    

        <h3 class="mt-3">Descrição Completa do Produto</h3>
        <table class="table table-bordered text-center">
            <thead class="thead-dark">
                <tr>
                    <th>Descrição Completa</th>
                </tr>
            </thead>
            <tbody id="tabelaDescricaoCompleta">
                <td>Nenhuma descrição disponível</td>
            </tbody>
        </table>
  
    <!-- Botão de copiar para a tabela "Descrição Completa do Camarão" -->
    <div class="copiar-botao-container">
        <button class="btn btn-primary" onclick="copiarTabela2('tabelaDescricaoCompleta')">Copiar</button>
    </div>
    
    </div>
    
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"></script>
    <script src="script.js"></script>
    <script src="dropdown.js"></script>
    <script src="util.js"></script>
    <script src="api.js"></script>
    
    <script>
        function copiarTabela1(tabelaId) {
            const tabela = document.getElementById(tabelaId);
            if (!tabela) return;
        
            let texto = '';
            const linhas = tabela.getElementsByTagName('tr');
            for (let i = 0; i < linhas.length; i++) {
                const colunas = linhas[i].getElementsByTagName('td');
                if (colunas.length > 0) {
                    const ultimaColuna = colunas[colunas.length - 1].innerText.trim(); // Pega a última coluna
                    if (validarCodigoCompleto(ultimaColuna)) { // Valida o código completo
                        texto += ultimaColuna + '\n'; // Adiciona a última coluna e uma nova linha
                    } else {
                        alert('Erro: O código está incorreto. Verifique se todos os campos estão preenchidos corretamente.');
                        return;
                    }
                }
            }
        
            navigator.clipboard.writeText(texto).then(
                () => alert('Última coluna copiada para a área de transferência!'),
                (err) => alert('Erro ao copiar a tabela: ' + err)
            );
        }
        
        // Função de validação do código completo
        function validarCodigoCompleto(codigo) {
            const somenteNumeros = codigo.replace(/\s/g, '').length; // Remove os espaços e conta os números
            return somenteNumeros === 20 && /^[0-9\s]+$/.test(codigo) ; // Valida 19 dígitos numéricos com espaços
        }
        
        
    </script>

    <script>
        function copiarTabela2(idTabela) {
            // Captura o elemento da tabela pelo ID
            const tabela = document.getElementById(idTabela);
        
            // Pega o texto interno da tabela e remove espaços extras
            const texto = tabela.innerText.trim();
        
            // Copia o texto para a área de transferência
            navigator.clipboard.writeText(texto)
                .then(() => {
                    alert("Texto copiado com sucesso!");
                })
                .catch(err => {
                    alert("Erro ao copiar o texto.");
                    console.error(err);
                });
        }
    </script>

    <script>
        document.getElementById("botaoSair")?.addEventListener("click", () => {
            const confirmacao = confirm("Tem certeza de que deseja sair?");
            if (confirmacao) {
                // Remove o token do localStorage
                localStorage.removeItem("token");
                
                // Exibe uma mensagem de saída bem-sucedida
                alert("Você saiu com sucesso!");
        
                // Redireciona o usuário para a página de login
                window.location.href = "login.html";
            }
        });
    </script>

    <script>
        iniciarPing();
    </script>
    
</body>
</html>


